<% layout ('layouts/boilerplate') -%>
<h1>Posts Index!</h1>
<div id="map"></div>


<% include ../partials/paginatePosts %>

<!-- Iterate over all those posts that we're passing in as local variable -->
<% posts.docs.forEach(function(post) { %>
  <div>
    <h2><%= post.title %></h2>
    <div class="">Price: <%= post.price %></div>
    <div><%= post.description %></div>
    <div><%= post.location %></div>
    <div><a href="/posts/<%= post.id %>">View more</a></div>
  </div>
<% }); %>

<% include ../partials/paginatePosts %>

<script>
  mapboxgl.accessToken = "<%= mapBoxToken %>";
  let posts = { features: <%- JSON.stringify(posts.docs) %> }; //since it is paginated we need to send posts.docs
  //because this is the format used in mongoose paginate package
</script>
<script src="/javascripts/allPostsClusterMap.js"></script> <!-- There logic for maps living -->
